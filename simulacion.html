 <html>
   <head>
   <title>Esta es una pagina web</title>
   <script type="text/javascript">
		var NF1 , NF2, NI1 , NI2, NE, STP, STL, STPL, STC;//estado
		var M, N, SRC, SRPL, TPPL, TPC; //control
		var T,HV,TF;
		
		function inicializacion(){
			debugger;
			NF1 = 0;
			NF2 = 0;
			NI1 = 0; 
			NI2 = 0;
			NE = 0;
			STP = 20;
			STL = 5;
			STPL = TPPL;
			STC = TPC;
			T = 0;
			TF = 100000000;
			HV = 99999;
		}

		function B1(){


		}



		var llegadaPedidoEv = new Object();
		var terminaImpresionEv = new Object();
		var terminaFabricacionEv = new Object();
		var terminaEmpacado1Ev = new Object();
		var terminaEmpacado2Ev = new Object();
		var reposicionPlasticoEv = new Object(); 
		var reposicionLacaEv = new Object();
		var reposicionPinturaEv = new Object();
		var reposicionCajasEv = new Object();
		var maquinaFabricacion = new Object();
		var maquinaImpresion = new Object();		   
		var eventosFuturos = new Array();
		var colaB1F = new Array();
		var colaB2F = new Array();
		var colaB1I = new Array();
		var colaB2I = new Array();
		var colaBE = new Array();
		
	
		maquinaFabricacion.modulo = 0;
		maquinaFabricacion.configuracionPomo = 'B1';
		maquinaFabricacion.cantTipoConsecutivo = M;
		maquinaFabricacion.numeroCola1 = NF1;
		maquinaFabricacion.numeroCola2 = NF2;
		maquinaFabricacion.cola1 = colaB1F;
		maquinaFabricacion.cola2 = colaB2F;
		maquinaFabricacion.demoraDistintoPedido = 4;
		maquinaFabricacion.demoraMismoPedido = 2;

	
		maquinaImpresion.modulo = 0;
		maquinaImpresion.configuracionPomo = 'B1';
		maquinaImpresion.cantTipoConsecutivo = N;
		maquinaImpresion.numeroCola1 = NI1;
		maquinaImpresion.numeroCola2 = NI2;
		maquinaImpresion.cola1 = colaB1I;
		maquinaImpresion.cola2 = colaB2I;
		maquinaImpresion.demoraDistintoPedido = 8;
		maquinaImpresion.demoraMismoPedido = 4;


		llegadaPedidoEv.funcion = llegadaPedido;
		terminaImpresionEv.funcion = terminaImpresion;
		terminaFabricacionEv.funcion = terminaFabricacion;
		terminaEmpacado1Ev.funcion = terminaEmpacado;
		terminaEmpacado2Ev.funcion = terminaEmpacado;
		reposicionPlasticoEv.funcion = reposicionPlastico;
		reposicionLacaEv.funcion = reposicionLaca;
		reposicionPinturaEv.funcion = reposicionPintura;
		reposicionCajasEv.funcion = reposicionCajas;

		eventosFuturos.push(llegadaPedidoEv,terminaImpresionEv ,terminaFabricacionEv ,terminaEmpacado1Ev ,terminaEmpacado2Ev ,
		reposicionPlasticoEv ,reposicionLacaEv ,reposicionPinturaEv ,reposicionCajasEv);


		eventosFuturos.forEach(function(elemento, indice){elemento.tiempo = 0;});
		terminaEmpacado1Ev.tiempo = -1;

		function obtenerEventoFuturoProximo() {
		 
			return eventosFuturos.sort(function(a,b){return a.tiempo - b.tiempo})[0];
		}

		function funcion (){
			return 2*2;
		}

		function iniciarSimulacion() {
			
			//srand(time(NULL));
			inicializacion();
			simulacion();
		}


		function simulacion(){
			do{
				debugger;
				eventoFuturo = obtenerEventoFuturoProximo()
				eventoFuturo.funcion(eventoFuturo);
			}
			while(T <= TF);
		}

		function creacionDePedido(){
			pedido = new Object();
			pedido.tipoPomo = obtenerTipoPomo();
			pedido.tamanioPedido = obtenerTamanioPedido();

			return pedido;
		}

		function llegadaPedido(){

			T = llegadaPedido.tiempo;
			llegadaPedido.tiempo = T + obtenerIntervaloPedido();
			unPedido = creacionDePedido();

			if(Math.random() < 0.91)
				llegaPedidoCompleto(unPedido);
			else
				llegaPedidoImpresion(unPedido);
				
		}

		function getIntervaloPedido(){//IP
			var R = Math.random();
			return Math.round((447.1/0.3658) * (Math.pow((Math.log(1/R)),-0.3658) - 1) + 453.69);
		}

		function ubicarEnColaDe(maquina,unPedido){

			if(unPedido.tipoPomo == 'B1'){
				maquina.numeroCola1++;
				maquina.cola1.push(unPedido);
			}else{
				maquina.numeroCola2++;
				maquina.cola2.push(unPedido);
			}
		}

	
		function ubicarEnColaDeEmpaque(unPedido){

			colaBE.push(unPedido);
		}

		function llegaPedidoCompleto(unPedido){
						
			ubicarEnColaDe(maquinaFabricacion,unPedido);

			if(maquinaFabricacion.numeroCola1 + maquinaFabricacion.numeroCola2 == 1){
			
				actualizarEstadoMaquina(maquinaFabricacion);
			
				var demora = obtenerDemoraPreparacion(maquinaFabricacion, obtenerTipoPomoAProducir());

				terminaFabricacionEv.tiempo = T + demora + obtenerDemoraDeFabricacion(unPedido);
			}
			else{

			} //calculo de resultados

		}

		function terminaFabricacion(){

			T = terminaFabricacionEv.tiempo;

			var pedidoParaImpresion = sacarPedidoTerminadoDe(maquinaFabricacion);
			consumoDePlastico(pedidoParaImpresion);
			ubicarEnColaDeImpresion(pedidoParaImpresion);

			if(maquinaFabricacion.numeroCola1 > 0 || maquinaFabricacion.numeroCola2 > 0){
				actualizarEstadoMaquina(maquinaFabricacion);
				var tipoPomoAProducir = obtenerTipoPomoAProducir(maquinaFabricacion);
				var pedidoAFabricar = obtenerPedidoDe(maquinaFabricacion, tipoPomoAProducir);
				var demora = obtenerDemoraPreparacion(maquinaFabricacion, tipoPomoAProducir);
				terminaFabricacionEv.tiempo = T + demora + obtenerDemoraDeFabricacion(pedidoAFabricar);
			}
			else
			{
				terminaFabricacionEv.tiempo = HV;
			}
				
			if(maquinaImpresion.numeroCola1 + maquinaImpresion.numeroCola2 == 1){
				actualizarEstadoMaquina(maquinaImpresion);
				var tipoPomoAProducir = obtenerTipoPomoAProducir(maquinaImpresion);
				var pedidoAImprimir = obtenerPedidoDe(maquinaImpresion, tipoPomoAProducir);
				var demora = obtenerDemoraPreparacion(maquinaImpresion, tipoPomoAProducir);
				terminaImpresionEv.tiempo = T + demora + obtenerDemoraDeImpresion(pedidoAImprimir);
			}
			
			if(STPL <= SRPL && reposicionPlasticoEv.tiempo == HV)
				reposicionPlasticoEv.tiempo = T + obtenerDemoraDeRecepcionDePlastico();
			
		}

		function sacarPedidoTerminadoDe(maquina){

			if(maquina.configuracionPomo == 'B1'){
				maquina.numeroCola1--;
				maquina.cola1.shift();
			}else{
				maquina.numeroCola2--;
				maquina.cola2.shift();
			}

		}

		function llegaPedidoImpresion(unPedido){
			
			ubicarEnColaDeImpresion(unPedido);
			if(maquinaImpresion.numeroCola1 + maquinaImpresion.numeroCola2 == 1){
				actualizarEstadoMaquina(maquinaImpresion);

				var demora = obtenerDemoraPreparacion(maquinaImpresion , obtenerTipoPomoAProducir());

				terminaImpresionEv.tiempo = T + demora + obtenerDemoraDeImpresion(unPedido);
			}
			else {}//calculo de resultados
			
		}

		function terminaImpresion(){
			T = terminaImpresionEv.tiempo;

			var pedidoParaEmpacado = sacarPedidoTerminadoDe(maquinaImpresion);
			consumoDePintura(pedidoParaEmpacado.tamanioPedido);
			consumoDeLaca(pedidoParaEmpacado.tipoPomo, pedidoParaEmpacado.tamanioPedido);
			NE++;

			if(maquinaImpresion.numeroCola1 > 0 || maquinaImpresion.numeroCola2 > 0){

				actualizarEstadoMaquina(maquinaImpresion);
				var tipoPomoAProducir = obtenerTipoPomoAProducir(maquinaImpresion);
				var unPedido = obtenerPedidoDe(maquinaImpresion, tipoPomoAProducir);
				var demora = obtenerDemoraPreparacion(maquinaImpresion, tipoPomoAProducir);
				terminaImpresionEv.tiempo = T  + demora + obtenerDemoraDeImpresion();
			}
			else {
				terminaImpresionEv.tiempo = HV;

			}//no hay más pintado ver que se hace

			
			if(NE <= 2){
				if(terminaEmpacado1Ev.tiempo == HV){

					terminaEmpacado1Ev.tiempo = T + obtenerDemoraDeEmbalado(pedidoParaEmpacado);
				}
				else
					terminaEmpacado2Ev.tiempo = T + obtenerDemoraDeEmbalado(pedidoParaEmpacado);
			

			}
			else
				ubicarEnColaDeEmpaque(pedidoParaEmpacado);
			
			if(STL <= 20 && reposicionLacaEv.tiempo == HV)
				reposicionLacaEv.tiempo = T + 24*60; 
			
			if(STP <= 5 && reposicionPinturaEv.tiempo == HV)
				reposicionPinturaEv.tiempo = T + 24*60;
		}

		
		function obtenerPedidoAEmpacar(){
			return colaBE.shift();
		}

		function terminaEmpacado(terminaEmpacadoEv){
			T = terminaEmpacadoEv.tiempo;
			NE--;
			if(NE > 1)
				var pedidoAEmpacar = obtenerPedidoAEmpacar();
				terminaEmpacadoEv.tiempo = T + obtenerDemoraDeEmbalado(pedidoAEmpacar);
				
			if(STC <= SRC && reposicionCajasEv.tiempo == 99999)
				reposicionCajasEv.tiempo = T + 24*60;				
			
		}

		function reposicionPlastico(){
			STPL = STPL + TPP;
			reposicionPlasticoEv.tiempo = HV;
		}

		function reposicionLaca(){
			STL = STL + 20;
			reposicionLavaEv.tiempo = HV;
		}

		function reposicionPintura(){
			STP = STP + 5;
			reposicionPinturaEv.tiempo = HV;
		}

		function reposicionCajas(){
			STC = STC + TPC;
			reposicionCajasEv.tiempo = HV;
		}
		function obtenerTipoPomo(){


		}

		function obtenerTamanioPedido(){//CANT
			var R = Math.random();
			return Math.round(4766.5 * Math.sqrt(Math.log(1/Math.pow((1-R),2))));
		}

		function obtenerDemoraDeEmbalado(unPedido){
			//hacer for por el tamaño de pedido leira
			if(unPedido.tipoPomo == 'B1')
				funcion = demoraEmbaladoB1; 
			else 
				funcion = demoraEmbaladoB2;
		
			for(var i=0; i++)
		};
		
		function demoraEmbaladoB1(){//TE1
			var R = Math.random();
			return Math.round(95.055 / (Math.pow(((1/R) - 1),(1/3.419))) + 26.651);
		}

		function demoraEmbaladoB2(){//TE2
			var R = Math.random();
			return Math.round(95.055 / (Math.pow(((1/R) - 1),(1/3.419))) + 26.651);
		}

		function obtenerDemoraDeFabricacion(){
			//1 hora cada 10kg. TODO
		};
		function obtenerDemoraDeImpresion(unPedido){//TI
			//falta for por la cantidad
			//esto es cada 1000
			var R = Math.random();
			return Math.round(32.835 / Math.pow((Math.log(1/R)),(1/2.6808)));
		};

		function consumoDePlastico(unPedido){
			return unPedido.cantidadPomos * obtenerConsumoPlasticoIndividualSegun(unPedido.tipoPomo);

		};

		function obtenerConsumoPlasticoIndividualSegun(tipoPomo){
			if(tipoPomo == 'B1')
				return 3.68;
			else
				return 15.15;


		}
		
		function obtenerDemoraDeRecepcionDePlastico(){
			return 8*60*2; // TODO está harcadoeado en 2 días, mañana lo corrijo
		}

		function consumoDePintura(cantidadPomos){//CONS_PINT
			var gramosPorLote1000 = obtenerCantPinturaPorLote();
			return cantidadLotes(cantidadPomos) * gramosPorLote1000;
		}
		
		function cantidadLotes(cantidadPomos){
			return Math.ceil(cantidadPomos/1000);
		}
		
		function obtenerCantPinturaPorLote(){
			var R = Math.random();
			return Math.round((2.6507 * Math.tan(Math.PI * (R-0.5)) + 20.027)/5)*5;
		}

		function consumoDeLaca(tipoPomo, cantidadPomos){
			//El consumo de laca esta determinado de acuerdo al tamanio del pomo (es un valor fijo por cada lote)
			//TODO HACER QUE SI MIL CONSUMEN TANTO CUANTO CONSUME CADA UNO
		}

		function obtenerDemoraPreparacion(maquina, tipoPomoAProducir){
			
			if(maquina.configuracionPomo != tipoPomoAProducir){
				maquina.modulo = Math.ceil(maquina.modulo/maquina.cantTipoConsecutivo)*maquina.cantTipoConsecutivo + 1;
				maquina.configuracionPomo = tipoPomoAProducir;
				return maquina.demoraDistintoPedido;
			}else{
				maquina.modulo++;
				return maquina.demoraMismoPedido;
			}

		}
		
		function obtenerTipoPomoAProducir(maquina){

			if(maquina.configuracionPomo == 'B1')
				maquina.numeroCola1 > 0 ? 'B1' : 'B2';				
			else
				maquina.numeroCola2 > 0 ? 'B2' : 'B1';					

		}

		function obtenerDemoraPreparacionDeImpresion(){
			var moduloCorrector = obtenerEstadoMaquina();
			var demora;
		}

		function obtenerDemoraMismaCola(maquina){ 
			maquina.modulo++;
			return maquina.demoraMismoPedido;
		}

		function obtenerDemoraDistintaCola(moduloCorrector, maquina){
			maquina.modulo = moduloCorrector;
			return maquina.demoraDistintoPedido;
		}

		function actualizarEstadoMaquina(maquina){
			if(maquina.modulo % maquina.cantTipoConsecutivo*2 < maquina.cantTipoConsecutivo)
				maquina.configuracionPomo = 'B1';			
			else
				maquina.configuracionPomo = 'B2';
		}


   </script>
   </head>
   <body>
   <script>
           document.write(iniciarSimulacion());
   </script>
   </body>
   </html>
